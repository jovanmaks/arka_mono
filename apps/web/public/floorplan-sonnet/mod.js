// Floorplan Sonnet Library - Built with esbuild
function T(e){let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let i=r.getContext("2d");if(!i)throw new Error("Could not get canvas context");return i.drawImage(e,0,0),i.getImageData(0,0,r.width,r.height)}function L(e){let{data:r,width:i,height:s}=e,t=new Uint8ClampedArray(i*s*4);for(let a=0;a<r.length;a+=4){let f=.299*r[a]+.587*r[a+1]+.114*r[a+2];t[a]=f,t[a+1]=f,t[a+2]=f,t[a+3]=r[a+3]}return new ImageData(t,i,s)}function U(e,r,i=!0){let{data:s,width:t,height:a}=e,f=new Uint8ClampedArray(t*a*4);for(let l=0;l<s.length;l+=4){let c=s[l],n=i?c<r?255:0:c>r?255:0;f[l]=n,f[l+1]=n,f[l+2]=n,f[l+3]=s[l+3]}return new ImageData(f,t,a)}function C(e,r=3){let{width:i,height:s}=e,t=new Uint8ClampedArray(i*s*4);t.set(e.data);let a=Math.floor(r/2),f=document.createElement("canvas");f.width=i,f.height=s;let l=f.getContext("2d");if(!l)throw new Error("Failed to get temporary canvas context");l.putImageData(e,0,0);let c=l.getImageData(0,0,i,s);for(let n=a;n<s-a;n++)for(let o=a;o<i-a;o++){let u=255;for(let g=-a;g<=a;g++)for(let h=-a;h<=a;h++){let d=((n+g)*i+(o+h))*4;u=Math.min(u,c.data[d])}let m=(n*i+o)*4;t[m]=u,t[m+1]=u,t[m+2]=u}return new ImageData(t,i,s)}function A(e,r=3){let{width:i,height:s}=e,t=new Uint8ClampedArray(i*s*4);t.set(e.data);let a=Math.floor(r/2),f=document.createElement("canvas");f.width=i,f.height=s;let l=f.getContext("2d");if(!l)throw new Error("Failed to get temporary canvas context");l.putImageData(e,0,0);let c=l.getImageData(0,0,i,s);for(let n=a;n<s-a;n++)for(let o=a;o<i-a;o++){let u=0;for(let g=-a;g<=a;g++)for(let h=-a;h<=a;h++){let d=((n+g)*i+(o+h))*4;u=Math.max(u,c.data[d])}let m=(n*i+o)*4;t[m]=u,t[m+1]=u,t[m+2]=u}return new ImageData(t,i,s)}function j(e,r=3){let i=C(e,r);return A(i,r)}function q(e,r=3){let i=A(e,r);return C(i,r)}function k(e){let{width:r,height:i}=e,s=new Uint8ClampedArray(r*i*4),t=new Uint8ClampedArray(e.data),a=!0;for(let c=0;c<t.length;c+=4)t[c]=t[c]>128?1:0,t[c+1]=t[c],t[c+2]=t[c],t[c+3]=255;let f=0,l=100;for(;a&&f<l;){a=!1;let c=[];for(let n=1;n<i-1;n++)for(let o=1;o<r-1;o++){let u=(n*r+o)*4;if(t[u]===0)continue;let m=((n-1)*r+o)*4,g=((n-1)*r+(o+1))*4,h=(n*r+(o+1))*4,d=((n+1)*r+(o+1))*4,y=((n+1)*r+o)*4,I=((n+1)*r+(o-1))*4,w=(n*r+(o-1))*4,M=((n-1)*r+(o-1))*4,x=[t[m],t[g],t[h],t[d],t[y],t[I],t[w],t[M]],b=x.reduce((p,P)=>p+P,0);if(b<2||b>6)continue;let D=0;for(let p=0;p<x.length;p++)x[p]===0&&x[(p+1)%x.length]===1&&D++;D===1&&t[m]*t[h]*t[y]===0&&t[h]*t[y]*t[w]===0&&(c.push(u),a=!0)}for(let n of c)t[n]=0,t[n+1]=0,t[n+2]=0;c.length=0;for(let n=1;n<i-1;n++)for(let o=1;o<r-1;o++){let u=(n*r+o)*4;if(t[u]===0)continue;let m=((n-1)*r+o)*4,g=((n-1)*r+(o+1))*4,h=(n*r+(o+1))*4,d=((n+1)*r+(o+1))*4,y=((n+1)*r+o)*4,I=((n+1)*r+(o-1))*4,w=(n*r+(o-1))*4,M=((n-1)*r+(o-1))*4,x=[t[m],t[g],t[h],t[d],t[y],t[I],t[w],t[M]],b=x.reduce((p,P)=>p+P,0);if(b<2||b>6)continue;let D=0;for(let p=0;p<x.length;p++)x[p]===0&&x[(p+1)%x.length]===1&&D++;D===1&&t[m]*t[h]*t[w]===0&&t[m]*t[y]*t[w]===0&&(c.push(u),a=!0)}for(let n of c)t[n]=0,t[n+1]=0,t[n+2]=0}for(let c=0;c<t.length;c+=4){let n=t[c]===1?255:0;s[c]=n,s[c+1]=n,s[c+2]=n,s[c+3]=255}return new ImageData(s,r,i)}async function O(e,r=100){let i=e instanceof HTMLImageElement?e:await B(e),s=i.width,t=i.height;console.log(`[DEBUG] Original (H\xD7W): ${t} \xD7 ${s}`);let a=T(i),f=L(a);console.log("[DEBUG] After grayscale conversion");let l=U(f,r,!0);console.log("[DEBUG] After threshold");let c=j(l,3);console.log("[DEBUG] After open");let n=q(c,3);console.log("[DEBUG] After close");let o=k(n);return console.log("[DEBUG] After thinning"),{skeleton:o,originalWidth:s,originalHeight:t,debugInfo:{thresholdValue:r}}}function B(e){return new Promise((r,i)=>{let s=new Image;s.onload=()=>r(s),s.onerror=()=>i(new Error("Failed to load image")),typeof e=="string"?s.src=e:s.src=URL.createObjectURL(e)})}function V(e,r){r.width=e.width,r.height=e.height;let i=r.getContext("2d");if(!i)throw new Error("Could not get canvas context");i.putImageData(e,0,0)}function v(e){let r;if(Array.isArray(e)){if(e.length!==3||e[0].length!==3)throw new Error("Neighborhood must be a 3x3 array");if((e[1][1]>0?1:0)===0)return"none";r=[e[0][1]>0?1:0,e[0][2]>0?1:0,e[1][2]>0?1:0,e[2][2]>0?1:0,e[2][1]>0?1:0,e[2][0]>0?1:0,e[1][0]>0?1:0,e[0][0]>0?1:0]}else{if(e.length!==36)throw new Error("Neighborhood must contain 9 pixels (36 values in RGBA format)");if((e[4*4+0]>0?1:0)===0)return"none";r=[e[4*1+0]>0?1:0,e[4*2+0]>0?1:0,e[4*5+0]>0?1:0,e[4*8+0]>0?1:0,e[4*7+0]>0?1:0,e[4*6+0]>0?1:0,e[4*3+0]>0?1:0,e[4*0+0]>0?1:0]}let i=r.reduce((t,a)=>t+a,0),s=0;for(let t=0;t<r.length;t++)r[t]===0&&r[(t+1)%r.length]===1&&s++;if(i===1)return"endpoint";if(s===2){if(i===2)return"corner";if(i===3)return"t_junction"}return"none"}function E(e,r,i){let{width:s,height:t,data:a}=e;if(r<1||i<1||r>=s-1||i>=t-1)return null;let f=new Uint8ClampedArray(36);for(let l=-1;l<=1;l++)for(let c=-1;c<=1;c++){let n=((i+l)*s+(r+c))*4,o=((l+1)*3+(c+1))*4;f[o]=a[n],f[o+1]=a[n+1],f[o+2]=a[n+2],f[o+3]=a[n+3]}return f}function W(e,r=500,i=.001,s=10){let{width:t,height:a,data:f}=e,l=[];for(let c=1;c<a-1;c++)for(let n=1;n<t-1;n++){let o=(c*t+n)*4;if(f[o]===0)continue;let u=E(e,n,c);if(!u)continue;let m=v(u);m!=="none"&&(l.some(h=>Math.abs(h.x-n)<s&&Math.abs(h.y-c)<s)||l.push({x:n,y:c,type:m}))}return l.slice(0,r)}function $(e,r=20){if(e.length===0)return[];let i=Math.min(r,e.length),s=[],t=new Set;for(;s.length<i;){let n=Math.floor(Math.random()*e.length);t.has(n)||(t.add(n),s.push({...e[n]}))}let a=!0,f=100,l=0,c=new Array(e.length).fill(-1);for(;a&&l<f;){a=!1,l++;for(let o=0;o<e.length;o++){let u=e[o],m=1/0,g=-1;for(let h=0;h<s.length;h++){let d=s[h],y=Math.sqrt(Math.pow(u.x-d.x,2)+Math.pow(u.y-d.y,2));y<m&&(m=y,g=h)}c[o]!==g&&(c[o]=g,a=!0)}let n=s.map(()=>({x:0,y:0,count:0}));for(let o=0;o<e.length;o++){let u=c[o];n[u].x+=e[o].x,n[u].y+=e[o].y,n[u].count++}for(let o=0;o<s.length;o++)n[o].count>0&&(s[o].x=Math.round(n[o].x/n[o].count),s[o].y=Math.round(n[o].y/n[o].count))}return s}function _(e,r,i=!0){if(!i)return;let{width:s,height:t,data:a}=e;for(let f of r){let{x:l,y:c}=f;if(l<0||c<0||l>=s||c>=t)continue;let n=E(e,l,c),o;if(!n)o=[0,165,255];else switch(v(n)){case"endpoint":o=[255,0,0];break;case"corner":o=[0,0,255];break;case"t_junction":o=[0,255,0];break;default:o=[0,165,255]}for(let u=-1;u<=1;u++)for(let m=-1;m<=1;m++){let g=l+m,h=c+u;if(g<0||h<0||g>=s||h>=t)continue;let d=(h*s+g)*4;a[d]=o[0],a[d+1]=o[1],a[d+2]=o[2]}}}function H(e,r=50,i=150){let{width:s,height:t,data:a}=e,f=new Uint8ClampedArray(s*t*4);for(let l=0;l<a.length;l+=4){let c=a[l]>0?255:0;f[l]=c,f[l+1]=c,f[l+2]=c,f[l+3]=255}return new ImageData(f,s,t)}function N(e,r=1,i=Math.PI/180,s=50,t=50,a=10){let{width:f,height:l,data:c}=e,n=Math.sqrt(f*f+l*l),o=Math.ceil(n/r),u=Math.ceil(Math.PI/i),m=Array(o*2).fill(null).map(()=>Array(u).fill(0));for(let h=0;h<l;h++)for(let d=0;d<f;d++){let y=(h*f+d)*4;if(c[y]!==0)for(let I=0;I<u;I++){let w=I*i,M=d*Math.cos(w)+h*Math.sin(w),x=Math.round((M+n)/r);x>=0&&x<o*2&&m[x][I]++}}let g=[];for(let h=0;h<o*2;h++)for(let d=0;d<u;d++)if(m[h][d]>=s){let y=d*i,I=h*r-n,w=Math.cos(y),M=Math.sin(y);if(Math.abs(M)>.001){let b=Math.round(I/M),D=f-1,p=Math.round((I-D*w)/M);b>=0&&b<l&&p>=0&&p<l&&g.push({x1:0,y1:b,x2:D,y2:p})}else if(Math.abs(w)>.001){let b=Math.round(I/w),D=l-1,p=Math.round((I-D*M)/w);b>=0&&b<f&&p>=0&&p<f&&g.push({x1:b,y1:0,x2:p,y2:D})}}return g.filter(h=>{let d=h.x2-h.x1,y=h.y2-h.y1;return Math.sqrt(d*d+y*y)>=t})}function G(e){let{width:r,height:i,data:s}=e,t=[];for(let a=0;a<i;a++)for(let f=0;f<r;f++){let l=(a*r+f)*4;s[l]>0&&t.push({x:f,y:a})}return t}function F(e,r=5){if(e.length<2)return[];let i=[],s=new Set;for(let t=0;t<e.length;t++){if(s.has(t))continue;let a=e[t];s.add(t);for(let f=0;f<Math.PI;f+=Math.PI/16){let l=Math.cos(f),c=Math.sin(f),n=[a];for(let o=0;o<e.length;o++){if(t===o||s.has(o))continue;let u=e[o],m=u.x-a.x,g=u.y-a.y,h=m*l+g*c;Math.abs(m*c-g*l)<=r&&n.push(u)}if(n.length>=3){n.sort((m,g)=>{let h=(m.x-a.x)*l+(m.y-a.y)*c,d=(g.x-a.x)*l+(g.y-a.y)*c;return h-d});let o=n[0],u=n[n.length-1];for(let m=1;m<n.length-1;m++){let g=e.findIndex(h=>h.x===n[m].x&&h.y===n[m].y);g>=0&&s.add(g)}i.push({x1:o.x,y1:o.y,x2:u.x,y2:u.y});break}}}return i}function X(e,r=50,i=50,s=10,t=[]){if(t.length>=2){let c=[],n=s*3,o=(u,m)=>{let g=m.x-u.x,h=m.y-u.y,d=Math.sqrt(g*g+h*h),y=Math.max(5,Math.ceil(d/5)),I=0;for(let w=0;w<=y;w++){let M=w/y,x=Math.round(u.x+M*g),b=Math.round(u.y+M*h);if(x>=0&&x<e.width&&b>=0&&b<e.height){let D=(b*e.width+x)*4;e.data[D]>0&&I++}}return I>=y*.4};for(let u=0;u<t.length;u++)for(let m=u+1;m<t.length;m++){let g=t[u],h=t[m];Math.sqrt((h.x-g.x)**2+(h.y-g.y)**2)<=n&&o(g,h)&&c.push({x1:g.x,y1:g.y,x2:h.x,y2:h.y})}if(c.length>0)return console.log(`[INFO] Generated ${c.length} lines using corner points directly`),c}let a=G(e);if(a.length>0){let c=Math.max(2,Math.min(5,s/2)),o=F(a,c).filter(u=>{let m=u.x2-u.x1,g=u.y2-u.y1;return Math.sqrt(m*m+g*g)>=i});if(console.log(`[INFO] Connected ${o.length} wall lines from ${a.length} points`),o.length>=3)return o}console.log("[INFO] Falling back to Hough transform for line detection");let f=H(e,50,150);return N(f,1,Math.PI/180,r,i,s)}function Z(e,r,i=[0,255,0]){let{width:s,height:t,data:a}=e;for(let f of r){let{x1:l,y1:c,x2:n,y2:o}=f,u=l,m=c,g=Math.abs(n-l),h=Math.abs(o-c),d=l<n?1:-1,y=c<o?1:-1,I=g-h;for(;;){if(u>=0&&u<s&&m>=0&&m<t)for(let M=-1;M<=1;M++)for(let x=-1;x<=1;x++){let b=u+x,D=m+M;if(b>=0&&b<s&&D>=0&&D<t){let p=(D*s+b)*4;a[p]=i[0],a[p+1]=i[1],a[p+2]=i[2]}}if(u===n&&m===o)break;let w=2*I;w>-h&&(I-=h,u+=d),w<g&&(I+=g,m+=y)}}}export{H as cannyEdgeDetection,v as classifyPoint,$ as clusterPoints,F as connectWallPoints,L as convertToGrayscale,W as detectCorners,X as detectStraightWallsHough,A as dilate,_ as drawClusteredPoints,Z as drawLines,C as erode,N as houghLinesP,T as imageToImageData,B as loadImage,q as morphologicalClose,j as morphologicalOpen,k as morphologicalThinning,V as renderImageDataToCanvas,O as skeletonizeImage,U as threshold};
//# sourceMappingURL=mod.js.map
